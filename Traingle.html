<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Triangle</title>
    <style>
        button {
            background-color: green;
            width: 100px;
            height: 50px;
            float: bottom;
        }

        p {
            float: center;
        }
    </style>
</head>
<body style="margin:0">
    <canvas id="canvas" width="1000" height="500" style="border:5px solid darkcyan"></canvas>
    <button id="btn">Reset</button>
    <p>Press Enter to clear traingle</p>
    <script>
        // cordinates are stored to delete specific circles.
        var Traingles = [];
        var canvas = document.getElementById("canvas");
        var ctx = canvas.getContext("2d");
        var StartX = 0;
        var StartY = 0;
        var IsDrawing = false,
            imagedata, traingle, check = false, line, x1, y1, x2, y2, x3, y3, angle1, angle2,angle3,radius,curr,index;
            var flag = false; 
        angle1 = 90 * (Math.PI / 180);
        angle2 = angle1 + (2 * Math.PI) / 3;
        angle3 = angle2 + (2 * Math.PI) / 3;
        var colour = [2, 16, 32, 64, 128, 255, 255, 8, 0];
        var r;
        function getImage() {
            imagedata = ctx.getImageData(0, 0, canvas.width, canvas.height);
        }

        function putImage() {
            ctx.putImageData(imagedata, 0, 0);
        }

        function checkPath(){
            for(let i = 0; i < Traingles.length; i++){
                var curTraingle = Traingles[i];
               /*  radius = Math.sqrt(
                    Math.pow(curTraingle.start_x - currentX, 2) +
                    Math.pow(curTraingle.start_y - currentY, 2)
                ); */
                radius = curTraingle.rad;
                x1 = curTraingle.start_x + radius * Math.cos(angle1);
                y1 = curTraingle.start_y - radius * Math.sin(angle1);
                
                x2 = curTraingle.start_x + radius * Math.cos(angle2);
                y2 = curTraingle.start_y - radius * Math.sin(angle2);
                
                x3 = curTraingle.start_x + radius * Math.cos(angle3);
                y3 = curTraingle.start_y - radius * Math.sin(angle3);
                
                traingle = new Path2D();
                traingle.moveTo(x1, y1);
                traingle.lineTo(x2, y2);
                traingle.lineTo(x3, y3);
                traingle.closePath();
                if(ctx.isPointInPath(traingle,StartX,StartY)){
                    check = true;
                    index = i;
                    return curTraingle;
                }
            }

    }
    function redraw(){
        for(let i=0; i < Traingles.length; i++){
                var curTraingle = Traingles[i];
                if(curTraingle.start_x !== curr.start_x){
                radius = curTraingle.rad;
                x1 = curTraingle.start_x + radius * Math.cos(angle1);
                y1 = curTraingle.start_y - radius * Math.sin(angle1);
                
                x2 = curTraingle.start_x + radius * Math.cos(angle2);
                y2 = curTraingle.start_y - radius * Math.sin(angle2);
                
                x3 = curTraingle.start_x + radius * Math.cos(angle3);
                y3 = curTraingle.start_y - radius * Math.sin(angle3);
                
                traingle = new Path2D();
                traingle.moveTo(x1, y1);
                traingle.lineTo(x2, y2);
                traingle.lineTo(x3, y3);
                traingle.closePath();
                num = Math.floor(Math.random() * 10 + 1);
                no = Math.floor(Math.random() * 10 + 1);
                no1 = Math.floor(Math.random() * 10 + 1);
                ctx.fillStyle = `rgb(${colour[num]},${colour[no]},${colour[no1]})`;
                ctx.fill(traingle);
                ctx.lineWidth = 1.5;
                ctx.strokeStyle = "black";
                ctx.stroke(traingle);
                //console.log("Yes");                   
                }else{
                    Traingles.splice(index,1);
                    console.log("drawn");
                    continue;
                }
                
            }
            
    }
        var start = function (e) {
            StartX = e.clientX; //starting point
            StartY = e.clientY;
            IsDrawing = true;
            getImage();
            curr = checkPath();
            console.log(curr);
            //console.log(check);
        };

        function scl(e){
            // drawing here you path second time
            var currentX = e.clientX;
            var currentY = e.clientY;
            radius = Math.sqrt(
                    Math.pow(curr.start_x - currentX, 2) +
                    Math.pow(curr.start_y - currentY, 2)
                ); 
                x1 = curr.start_x + radius * Math.cos(angle1);
                y1 = curr.start_y - radius * Math.sin(angle1);
                
                x2 = curr.start_x + radius * Math.cos(angle2);
                y2 = curr.start_y - radius * Math.sin(angle2);
                
                x3 = curr.start_x + radius * Math.cos(angle3);
                y3 = curr.start_y - radius * Math.sin(angle3);
                
                traingle = new Path2D();
                traingle.moveTo(x1, y1);
                traingle.lineTo(x2, y2);
                traingle.lineTo(x3, y3);
                traingle.closePath();
                num = Math.floor(Math.random() * 10 + 1);
                no = Math.floor(Math.random() * 10 + 1);
                no1 = Math.floor(Math.random() * 10 + 1);
                ctx.fillStyle = `rgb(${colour[num]},${colour[no]},${colour[no1]})`;
                ctx.fill(traingle);
                ctx.lineWidth = 1.5;
                ctx.strokeStyle = "black";
                ctx.stroke(traingle);               
                
        }

        var draw = function (e) {
            if (!IsDrawing) return;
            putImage();
            var currentX = e.clientX;
            var currentY = e.clientY;
            
            if (!check) {
                radius = Math.sqrt(
                    Math.pow(StartX - currentX, 2) + Math.pow(StartY - currentY, 2)
                );
  
                x1 = StartX + radius * Math.cos(angle1);
                y1 = StartY - radius * Math.sin(angle1);

                x2 = StartX + radius * Math.cos(angle2);
                y2 = StartY - radius * Math.sin(angle2);

                x3 = StartX + radius * Math.cos(angle3);
                y3 = StartY - radius * Math.sin(angle3);

                ctx.beginPath();
                traingle = new Path2D();
                traingle.moveTo(x1, y1);
                traingle.lineTo(x2, y2);
                traingle.lineTo(x3, y3);

                traingle.closePath();
                num = Math.floor(Math.random() * 10 + 1);
                no = Math.floor(Math.random() * 10 + 1);
                no1 = Math.floor(Math.random() * 10 + 1);
                ctx.fillStyle = `rgb(${colour[num]},${colour[no]},${colour[no1]})`;
                ctx.fill(traingle);
                ctx.lineWidth = 1.5;
                ctx.strokeStyle = "black";
                ctx.stroke(traingle);

            }else{
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                redraw();
                scl(e); 
            }

        };

        var stop1 = function (e) {
            IsDrawing = false;
            Traingles.push({
                X1: x1,
                Y1: y1,
                X2: x2,
                Y2: y2,
                X3: x3,
                Y3: y3,
                start_x: StartX,
                start_y: StartY,
                rad: radius
            });
            var rect = canvas.getBoundingClientRect();
            check = false; 
            //console.log(Traingles);
            //console.table(index);
        };

        var clipR =function (e) {
            StartX = e.clientX;
            StartY = e.clientY;
            curr = checkPath();
            //Traingles.splice(index,1);
            if(check){
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            //setTimeout(redraw,300);
            console.log("deleted");
            redraw();
            IsDrawing = false;
            //e.preventDefault();                
            }
   
        }
        function clearR() {

            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }
/*         canvas.onmousemove= function (e){
            //console.log(e.clientX,e.clientY);
        } */
        
        canvas.addEventListener("mousedown", start,false);
        canvas.addEventListener("mousemove", draw,false);
        canvas.addEventListener("mouseup", stop1,false);
        canvas.addEventListener("contextmenu", clipR,false);
        document.addEventListener("keypress", function (event) {
            if (event.keyCode === 13 || event.which === 13) {
                clipR();
            }
        });
        var button = document.getElementById("btn");
        button.addEventListener("click", clearR);
    </script>
</body>
</html>